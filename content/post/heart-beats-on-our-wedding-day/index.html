---
title: "Heart Beats on Our Wedding Day"
author: ''
date: '2023-03-24'
slug: heart-beats-on-our-wedding-day
categories: []
tags:
  - data viz
subtitle: ''
summary: ''
authors: []
lastmod: '2023-03-24T15:52:02-07:00'
featured: false
draft: false
image:
  caption: ''
  focal_point: ''
  preview_only: true
projects: []
---



<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-1-1.png" width="864" /></p>
<p>I love data, so I wanted to somehow plot my wedding day. My now-husband wore his Fitbit on his wrist and I wore mine on my ankle (you can see it in the picture below). Fast-forward to eight months later and I have finally gotten around to plotting out our heart rate data. I designed it to match our wedding invites.</p>
<div class="figure">
<img src="images/R6_25064.jpg" style="width:80.0%" alt="" />
<p class="caption">Picture of me and my husband on our wedding day. We’re sitting on a couch and you can see my fitbit on my ankle.</p>
</div>
<div class="figure">
<img src="images/R6_21610.jpg" style="width:80.0%" alt="" />
<p class="caption">Picture of our wedding invites and rings.</p>
</div>
<p>Let’s get into it.</p>
<pre class="r"><code># Load packages
library(jsonlite)
library(tidyverse)
library(lubridate)
library(slider)
library(jpeg)
library(patchwork)
library(extrafont)
library(showtext)</code></pre>
<div id="data-wrangling" class="section level2">
<h2>Data Wrangling</h2>
<p>I used the <code>jsonlite</code> package to read in the heart rate data and format it nicely as a tibble. I then “normalized” our heart rates - mine runs about 5 bpm higher than my partner’s on average and I wanted them to have the same baseline. I then went through and annotated where we were for each timepoint - getting ready, at the church, at the rose garden, and at the reception. Because this data is all tied to time of day I found the <code>lubridate</code> package necessary. Finally, I used the <code>slider</code> package to calculate a rolling average of our heart rates to smooth the data a little bit.</p>
<pre class="r"><code># read in json files
hr_jj &lt;- read_json(&quot;jj_heart_rate-2022-07-09.json&quot;, simplifyVector = TRUE) %&gt;% 
  as_tibble() %&gt;% mutate(Name = &quot;JJ&quot;)
hr_rr &lt;- read_json(&quot;rr_heart_rate-2022-07-09.json&quot;, simplifyVector = TRUE) %&gt;% 
  as_tibble() %&gt;% mutate(Name = &quot;RR&quot;)

# normalize baselines
hr_jj_min &lt;- hr_jj$value$bpm %&gt;% sort() %&gt;% .[1:10] %&gt;% mean() %&gt;% as.integer() - 60
hr_rr_min &lt;- hr_rr$value$bpm %&gt;% sort() %&gt;% .[1:10] %&gt;% mean() %&gt;% as.integer() - 60 + 5
hr &lt;- full_join(hr_jj, hr_rr) %&gt;% 
  mutate(bpm_norm = case_when(Name == &quot;JJ&quot; ~ value$bpm - hr_jj_min,
                              Name == &quot;RR&quot; ~ value$bpm - hr_rr_min))

# annotate events
hr$dateTime &lt;- hr$dateTime %&gt;% mdy_hms()

getting_ready_start &lt;- ymd_hm(&quot;2022-07-09 8:50AM&quot;)
ceremony_start &lt;- ymd_hm(&quot;2022-07-09 1:00PM&quot;)
ceremony_end &lt;- ymd_hm(&quot;2022-07-09 2:15PM&quot;)
rose_garden_start &lt;- ymd_hm(&quot;2022-07-09 3:00PM&quot;)
rose_garden_end &lt;- ymd_hm(&quot;2022-07-09 4:15PM&quot;)
reception_start &lt;- ymd_hm(&quot;2022-07-09 4:30PM&quot;)
reception_end &lt;- ymd_hm(&quot;2022-07-09 9:30PM&quot;)

hr &lt;- hr %&gt;% 
  mutate(events = case_when(dateTime &gt; getting_ready_start &amp; dateTime &lt; ceremony_start ~ &quot;getting ready&quot;,
                            dateTime &gt; ceremony_start &amp; dateTime &lt; ceremony_end ~ &quot;ceremony&quot;,
                            dateTime &gt; rose_garden_start &amp; dateTime &lt; rose_garden_end ~ &quot;rose garden&quot;,
                            dateTime &gt; reception_start &amp; dateTime &lt; reception_end ~ &quot;reception&quot;))

hr$events &lt;- hr$events %&gt;% as_factor() %&gt;% fct_relevel(&quot;getting ready&quot;, &quot;ceremony&quot;, &quot;rose garden&quot;, &quot;reception&quot;)

# create rolling average
hr &lt;- hr %&gt;% 
  mutate(bpm_smooth = slide_dbl(bpm_norm, mean, .before = 10, .after = 10))</code></pre>
<pre><code>## # A tibble: 10 × 6
##    dateTime            value$bpm $confidence Name  bpm_norm events       bpm_s…¹
##    &lt;dttm&gt;                  &lt;int&gt;       &lt;int&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;fct&gt;          &lt;dbl&gt;
##  1 2022-07-09 08:50:04        70           3 JJ          70 getting rea…    70.4
##  2 2022-07-09 08:50:19        70           3 JJ          70 getting rea…    70.4
##  3 2022-07-09 08:50:34        71           3 JJ          71 getting rea…    70.4
##  4 2022-07-09 08:50:39        70           3 JJ          70 getting rea…    70.4
##  5 2022-07-09 08:50:44        69           3 JJ          69 getting rea…    70.4
##  6 2022-07-09 08:50:59        69           3 JJ          69 getting rea…    70.4
##  7 2022-07-09 08:51:04        70           3 JJ          70 getting rea…    70.4
##  8 2022-07-09 08:51:19        70           3 JJ          70 getting rea…    70.4
##  9 2022-07-09 08:51:29        71           3 JJ          71 getting rea…    70.4
## 10 2022-07-09 08:51:39        70           3 JJ          70 getting rea…    70.4
## # … with abbreviated variable name ¹​bpm_smooth</code></pre>
</div>
<div id="making-the-base-graph" class="section level2">
<h2>Making the Base Graph</h2>
<p>We have to start somewhere: here is what the basic bpm vs time line graph looks like without much customization.</p>
<pre class="r"><code>hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;)) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>I knew I wanted to break the data up into time windows indicating the different parts of the day so I first tried using <code>facet_wrap()</code> to get a quick look at how that would shake out.</p>
<pre class="r"><code>hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         !is.na(events)) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  facet_wrap(~events, nrow = 1, scales = &quot;free_x&quot;) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The facets really helped to contextualize the signal, which I liked, but because the different events were different lengths of time I needed the facets to be different sizes. For customizing at this degree I really like using the <code>patchwork</code> package which lets you stitch together individual graphs with a custom layout. Now instead of using one graph with facets, I’m stitching together 4 graphs and specifying the size of each.</p>
<pre class="r"><code>getting_ready &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;getting ready&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = &quot;Getting Ready&quot;) +
  theme(axis.title.x = element_blank())

ceremony &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;ceremony&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = &quot;Ceremony&quot;) +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank())

rose_garden &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;rose garden&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = &quot;Rose Garden&quot;) +
  theme(axis.title.y = element_blank())

reception &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;reception&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name)) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = &quot;Reception&quot;) +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank())

layout &lt;- c(&quot;AAAABCDDDDD&quot;)

getting_ready + ceremony + rose_garden + reception + plot_layout(design = layout, guides = &quot;collect&quot;) &amp; 
  theme(legend.position = &quot;bottom&quot;)</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>This was where I started to see the bones of the final product: I started customizing.</p>
</div>
<div id="building-the-final-graph" class="section level2">
<h2>Building the Final Graph</h2>
<p>The final graph is actually two parts stitched together: the top part is the actual graph part, and the bottom part just contains the text and flowers images. I used <code>patchwork</code> again to stitch them together.</p>
<div id="the-graph-graph" class="section level3">
<h3>The “Graph” Graph</h3>
<p>For the graph portion I basically used the same code as above, but started to adjust the theme heavily. I used the <code>extrafont</code> and <code>showtext</code> packages for fonts, making it easy to download and use fonts from Google Fonts. I talk more about how to do this in my <a href="https://jennifer-jahncke.netlify.app/post/sick-with-mono/">Sick with Mono</a> post. (I also talk about working with datetime data in the same post.) On top of the graph I also used text and arrow annotations in the graphs to label specific heart rate events.</p>
<pre class="r"><code>colors &lt;- c(&quot;RR&quot; = &quot;#DDCB68&quot;, &quot;JJ&quot; = &quot;#D84F7D&quot;)
font_add_google(&quot;Montserrat&quot;) # default font
font_add_google(&quot;Codystar&quot;) # decorative dot font
showtext_auto(enable = TRUE)

getting_ready &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;getting ready&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name), size = 0.7) +
  ### add annotation text: friends arriving in the morning
  geom_text(data = tibble(), mapping = aes(x = ymd_hm(&quot;2022-07-09 10:59AM&quot;), y = 95), label = toupper(&quot;friends arrive&quot;), 
            hjust = 0, vjust = 0, size = 2, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;) +
  annotate(geom = &quot;curve&quot;, size = 0.3, color = &quot;#F3EFEF&quot;,
           x = ymd_hm(&quot;2022-07-09 10:55AM&quot;), y = 96, 
           xend = ymd_hm(&quot;2022-07-09 10:09AM&quot;), yend = 85, 
           curvature = 0.4, arrow = arrow(length = unit(2, &quot;mm&quot;))) +
  ### 
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;, expand = c(0,0)) +
  ylim(c(60,125)) +
  labs(title = toupper(&quot;Getting Ready&quot;)) +
  scale_color_manual(values = colors) +
  theme_bw() +
  theme(axis.title.x = element_blank(),
        axis.text.y = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;),
        plot.title = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, size = 10, vjust = -2.5, lineheight = 0.8),
        legend.position = c(0.3,0.85),
        legend.direction = &quot;horizontal&quot;,
        legend.title = element_blank(),
        legend.background = element_rect(fill = &quot;transparent&quot;, color = &quot;#F3EFEF&quot;, size = 0.7),
        legend.text = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;),
        legend.key = element_rect(fill = &quot;transparent&quot;))

ceremony &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;ceremony&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name), size = 0.7) +
  ### add annotation text: walking down the aisle
  geom_text(data = tibble(), mapping = aes(x = ymd_hm(&quot;2022-07-09 1:27PM&quot;), y = 107), 
            label = str_wrap(toupper(&quot;walking down the aisle&quot;), width = 8),
            hjust = 0.5, vjust = 0, size = 2, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, lineheight = 0.8) +
  annotate(geom = &quot;curve&quot;, size = 0.3, color = &quot;#F3EFEF&quot;,
           x = ymd_hm(&quot;2022-07-09 1:25PM&quot;), y = 105,
           xend = ymd_hm(&quot;2022-07-09 1:25PM&quot;), yend = 93,
           curvature = 0, arrow = arrow(length = unit(2, &quot;mm&quot;))) +
  ### 
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = toupper(&quot;Ceremony&quot;)) +
  scale_color_manual(values = colors) +
  theme_bw() +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, size = 10, vjust = -2.5, hjust = 0.5, lineheight = 0.8),
        legend.position = &quot;none&quot;)

rose_garden &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;rose garden&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name), size = 0.7) +
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;) +
  ylim(c(60,125)) +
  labs(title = toupper(&quot;Rose\nGarden&quot;)) +
  scale_color_manual(values = colors) +
  theme_bw() +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, size = 10, vjust = -1, lineheight = 0.8),
        legend.position = &quot;none&quot;)

reception &lt;- hr %&gt;% 
  filter(dateTime &lt; as.Date(&quot;2022-07-10&quot;),
         events == &quot;reception&quot;) %&gt;% 
  ggplot(aes(x = dateTime, y = bpm_smooth)) +
  geom_line(aes(color = Name), size = 0.7) +
  
  ### add annotation text: tequila
  geom_text(data = tibble(), mapping = aes(x = ymd_hm(&quot;2022-07-09 5:28PM&quot;), y = 70), 
            label = toupper(&quot;tequila&quot;),
            hjust = 0.5, vjust = 0, size = 2, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;) +
  annotate(geom = &quot;curve&quot;, size = 0.3, color = &quot;#F3EFEF&quot;,
           x = ymd_hm(&quot;2022-07-09 5:28PM&quot;), y = 73,
           xend = ymd_hm(&quot;2022-07-09 5:28PM&quot;), yend = 83,
           curvature = 0, arrow = arrow(length = unit(2, &quot;mm&quot;))) +
  ### 
  
  ### add annotation text: dancing
  geom_text(data = tibble(), mapping = aes(x = ymd_hm(&quot;2022-07-09 7:45PM&quot;), y = 120), 
            label = toupper(&quot;dancing&quot;),
            hjust = 1, vjust = 0, size = 2, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;) +
  annotate(geom = &quot;curve&quot;, size = 0.3, color = &quot;#F3EFEF&quot;,
           x = ymd_hm(&quot;2022-07-09 7:48PM&quot;), y = 120,
           xend = ymd_hm(&quot;2022-07-09 8:06PM&quot;), yend = 105,
           curvature = -0.4, arrow = arrow(length = unit(2, &quot;mm&quot;))) +
  ### 
  
  ### add annotation text: couples pictures
  geom_text(data = tibble(), mapping = aes(x = ymd_hm(&quot;2022-07-09 7:00PM&quot;), y = 75), 
            label = str_wrap(toupper(&quot;couples pictures downtown&quot;), width = 8),
            hjust = 0.5, vjust = 0, size = 2, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, lineheight = 0.8) +
  annotate(geom = &quot;curve&quot;, size = 0.3, color = &quot;#F3EFEF&quot;,
           x = ymd_hm(&quot;2022-07-09 7:00PM&quot;), y = 74,
           xend = ymd_hm(&quot;2022-07-09 8:37PM&quot;), yend = 60,
           curvature = 0.3, arrow = arrow(length = unit(2, &quot;mm&quot;))) +
  ### 
  
  scale_x_datetime(date_breaks = &quot;1 hour&quot;, date_labels = &quot;%l%p&quot;, expand = c(0,0)) +
  ylim(c(60,125)) +
  labs(title = toupper(&quot;Reception&quot;)) +
  scale_color_manual(values = colors) +
  theme_bw() +
  theme(axis.title.x = element_blank(), axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        plot.title = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;, size = 10, vjust = -2.5, lineheight = 0.8),
        legend.position = &quot;none&quot;)

# patching the individual graphs together
layout &lt;- c(&quot;AAAABCDDDDD&quot;)

pltA &lt;- getting_ready + ceremony + rose_garden + reception + plot_layout(design = layout) &amp; 
  labs(y = toupper(&quot;Heart Rate (bpm)&quot;)) &amp;
  theme(plot.background = element_rect(fill = &quot;#1E3D42&quot;, color = &quot;#1E3D42&quot;),
        panel.background = element_rect(fill = &quot;#1E3D42&quot;, color = &quot;#1E3D42&quot;),
        panel.border = element_rect(color = &quot;#F3EFEF&quot;, size = 1),
        axis.text.x = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;),
        axis.title = element_text(family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;),
        axis.ticks = element_line(color = &quot;#F3EFEF&quot;),
        panel.grid = element_blank())

pltA</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-8-1.png" width="864" /></p>
</div>
<div id="the-image-graph" class="section level3">
<h3>The “Image” Graph</h3>
<p>For the decorative portion below the graph I created an “empty” graph using the <code>ggplot</code> theme <code>theme_void()</code>. I used <code>ggplot::geom_text()</code> for the text portions and <code>patchwork::inset_element()</code> to add the images. The images I had were just screen grabs from our invite mockups. These were jpeg files that I read in with <code>jpeg::readJPEG()</code> and converted to grobs using <code>grid::rasterGrob()</code>. <code>patchwork</code> doesn’t make it easy to flip an image, so I did that outside of R and used two separate images for the two insets.</p>
<pre class="r"><code>image_plt &lt;-  ggplot() +
  geom_text(aes(x = 0.5, y = 0), label = toupper(&quot;- July 9, 2022 -&quot;),
            hjust = 0.5, vjust = 0, size = 4, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;) +
  
  geom_text(aes(x = 0.5, y = 0.35), label = toupper(&quot;JJ + RR&quot;),
            hjust = 0.5, vjust = 0, size = 25, family = &quot;Codystar&quot;, color = &quot;#F3EFEF&quot;) +
  geom_text(aes(x = 0.5, y = 0.15), label = toupper(&quot;Jennifer Jahncke &amp; Ramiro Romo Jr.&quot;),
            hjust = 0.5, vjust = 0, size = 4, family = &quot;Montserrat&quot;, color = &quot;#F3EFEF&quot;) +
  
  coord_cartesian(ylim = c(0,1), xlim = c(0.05,1)) +
  inset_element(p = readJPEG(&quot;flowers-mirror.jpg&quot;, native = FALSE) %&gt;% grid::rasterGrob(), 
                left = -0.05,
                bottom = 0,
                right = 0.25,
                top = 1,) + 
  inset_element(p = readJPEG(&quot;flowers.jpg&quot;, native = FALSE) %&gt;% grid::rasterGrob(), 
                left = 0.7,
                bottom = 0,
                right = 1,
                top = 1) &amp; 
  theme_void() +
  theme(plot.background = element_rect(fill = &quot;#1E3D42&quot;, color = &quot;#1E3D42&quot;),
        panel.background = element_rect(fill = &quot;#1E3D42&quot;, color = &quot;#1E3D42&quot;))

image_plt</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-9-1.png" width="864" /></p>
</div>
<div id="putting-them-together" class="section level3">
<h3>Putting them together</h3>
<p>Now that I have the two separate components (<code>pltA</code> and <code>image_plt</code>), I used <code>patchwork</code> to stitch them together and add a title. I technically made the title as a subtitle but that was just so that I could adjust the theme of the title-title without affecting the titles of the subgraphs. This was lazy - really the titles of the subgraphs should be subtitles and the title of the overall graph should be a title but because of how I had put the graphs together prior to getting to this part I just used this workaround. And here is the final graph!</p>
<pre class="r"><code>pltA / image_plt + plot_layout(heights = c(3,2)) + plot_annotation(subtitle = toupper(&quot;Heart Beats on Our Wedding Day&quot;)) &amp; theme(plot.background = element_rect(fill = &quot;#1E3D42&quot;, color = &quot;#1E3D42&quot;),
      plot.subtitle = element_text(family = &quot;Codystar&quot;, color = &quot;#F3EFEF&quot;, size = 33, hjust = 0.5, vjust = -1.5, face = &quot;bold&quot;))</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-10-1.png" width="864" /></p>
</div>
</div>
